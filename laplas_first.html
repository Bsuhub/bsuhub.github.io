<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–µ–æ—Ä–µ–º–∞ –õ–∞–ø–ª–∞—Å–∞ (Mobile Friendly)</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MathJax –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö —Ñ–æ—Ä–º—É–ª -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>

    <style>
        :root {
            --bg: #1e1e2e;
            --card-bg: #313244;
            --text: #cdd6f4;
            --accent: #89b4fa;
            --green: #a6e3a1;
            --red: #f38ba8;
            --yellow: #f9e2af;
            --border: #45475a;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* –£–±–∏—Ä–∞–µ–º –≥–æ—Ä–∏–∑. –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
        }

        h1 {
            font-size: 1.2rem;
            text-align: center;
            color: var(--accent);
            margin: 10px 0;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
        }

        button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            flex: 1 1 auto; /* –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞—é—Ç—Å—è */
            min-width: 120px;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.96); }
        .btn-gen { background: var(--accent); color: #1e1e2e; }
        .btn-start { background: var(--green); color: #1e1e2e; }
        .btn-next { background: var(--yellow); color: #1e1e2e; }
        .btn-reset { background: var(--red); color: #1e1e2e; }
        button:disabled { opacity: 0.5; filter: grayscale(1); }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-layout {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        /* –°–µ–∫—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã */
        .matrix-section {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .row-selectors {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-right: 8px;
            padding-top: 5px;
        }

        .row-checkbox {
            width: 30px; 
            height: 30px; /* –í—ã—Å–æ—Ç–∞ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —è—á–µ–π–∫—É */
            display: flex;
            align-items: center;
            justify-content: center;
            background: #45475a;
            color: #fff;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
        }
        .row-checkbox.selected { background: var(--yellow); color: #1e1e2e; font-weight: bold; }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }

        .cell {
            width: 40px; 
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #1e1e2e;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 16px;
            position: relative;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 450px) {
            .cell { width: 13vw; height: 13vw; font-size: 14px; max-width: 45px; max-height: 45px; }
            .row-checkbox { height: 13vw; width: 25px; max-height: 45px; font-size: 10px; }
            .matrix-section { width: 100%; justify-content: center; }
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è —è—á–µ–µ–∫ */
        .cell.in-row { background: rgba(249, 226, 175, 0.2); border-color: var(--yellow); }
        .cell.in-col { background: rgba(166, 227, 161, 0.2); border-color: var(--green); }
        .cell.intersection { 
            background: var(--red); 
            color: #1e1e2e; 
            font-weight: bold; 
            z-index: 2;
        }
        .cell.complement {
            background: #cba6f7;
            color: #1e1e2e;
            opacity: 0.8;
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .info-panel {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .status-text { font-size: 0.95rem; line-height: 1.4; }

        /* –ë–ª–æ–∫ —Å —Ñ–æ—Ä–º—É–ª–æ–π */
        .formula-container {
            background: #11111b;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow-x: auto;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –î–µ—Ç–∞–ª–∏ —à–∞–≥–∞ (–º–∏–Ω–æ—Ä—ã) */
        .step-viz {
            display: none;
            flex-direction: column;
            gap: 10px;
            background: #252635;
            padding: 10px;
            border-radius: 8px;
        }
        
        .mini-matrices-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .mini-matrix {
            display: grid;
            gap: 2px;
            background: #fff;
            padding: 2px;
            border-radius: 2px;
        }
        .mini-cell {
            width: 25px; height: 25px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px;
            color: #000;
            font-weight: bold;
        }
        .mini-label { font-size: 12px; text-align: center; margin-bottom: 4px; color: #aaa; }

    </style>
</head>
<body>

    <h1>–û–±–æ–±—â–µ–Ω–Ω–∞—è –¢–µ–æ—Ä–µ–º–∞ –õ–∞–ø–ª–∞—Å–∞</h1>

    <div class="controls">
        <button class="btn-gen" onclick="generateMatrix()">üé≤ –ù–æ–≤–∞—è –º–∞—Ç—Ä–∏—Ü–∞</button>
        <button class="btn-start" id="btnStart" onclick="startAlgorithm()">üöÄ –ù–∞—á–∞—Ç—å</button>
        <button class="btn-next" id="btnNext" onclick="nextStep()" disabled>–î–∞–ª–µ–µ</button>
        <button class="btn-reset" onclick="reset()">‚Ü∫ –°–±—Ä–æ—Å</button>
    </div>

    <div class="main-layout">
        <!-- –°–µ–∫—Ü–∏—è –ú–∞—Ç—Ä–∏—Ü—ã -->
        <div class="matrix-section">
            <div class="row-selectors" id="rowSelectors"></div>
            <div class="grid" id="matrixGrid"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ò–Ω—Ñ–æ -->
        <div class="info-panel">
            <div class="status-text" id="statusText">
                1. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏, –Ω–∞–∂–∞–≤ –Ω–∞ –Ω–æ–º–µ—Ä–∞ —Å–ª–µ–≤–∞.<br>
                2. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å".
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ -->
            <div>
                <small style="color:#aaa">–û–±—â–∞—è —Ñ–æ—Ä–º—É–ª–∞:</small>
                <div class="formula-container" id="mainFormula">
                    $$ \det(A) = \dots $$
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª–∏ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ -->
            <div class="step-viz" id="stepViz">
                <div style="text-align: center; font-size: 0.9rem;">–¢–µ–∫—É—â–µ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ:</div>
                
                <!-- –§–æ—Ä–º—É–ª–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞ -->
                <div id="stepFormula" style="text-align: center; margin: 10px 0;"></div>

                <div class="mini-matrices-row">
                    <div>
                        <div class="mini-label" style="color:var(--red)">–ú–∏–Ω–æ—Ä M</div>
                        <div id="minorViz"></div>
                    </div>
                    <div style="font-size: 20px;">√ó</div>
                    <div>
                        <div class="mini-label" style="color:#cba6f7">–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ M*</div>
                        <div id="compViz"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const N = 5;
        let matrix = [];
        let selectedRows = [];
        let combinations = [];
        let currentStepIndex = 0;
        let isRunning = false;
        let formulaLatex = ""; // –°—Ç—Ä–æ–∫–∞ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è LaTeX —Ñ–æ—Ä–º—É–ª—ã

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        window.onload = () => {
            createGrid();
            generateMatrix();
        };

        function createGrid() {
            const grid = document.getElementById('matrixGrid');
            const selectors = document.getElementById('rowSelectors');
            grid.innerHTML = '';
            selectors.innerHTML = '';

            for (let i = 0; i < N; i++) {
                // –ß–µ–∫–±–æ–∫—Å —Å—Ç—Ä–æ–∫–∏
                const sel = document.createElement('div');
                sel.className = 'row-checkbox';
                sel.innerText = i + 1;
                sel.id = `row-sel-${i}`;
                sel.onclick = () => toggleRow(i);
                selectors.appendChild(sel);

                // –Ø—á–µ–π–∫–∏
                for (let j = 0; j < N; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${i}-${j}`;
                    grid.appendChild(cell);
                }
            }
        }

        function generateMatrix() {
            if (isRunning) reset();
            matrix = [];
            for (let i = 0; i < N; i++) {
                const row = [];
                for (let j = 0; j < N; j++) {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –æ—Ç -9 –¥–æ 9
                    const val = Math.floor(Math.random() * 19) - 9;
                    row.push(val);
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    cell.innerText = val;
                    cell.className = 'cell'; // —Å–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π
                }
                matrix.push(row);
            }
            // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∏ –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∏—Ö –∑–∞–Ω–æ–≤–æ
            updateRowHighlights();
        }

        // --- –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–æ–∫ ---
        function toggleRow(rowIndex) {
            if (isRunning) return;
            const idx = selectedRows.indexOf(rowIndex);
            if (idx === -1) selectedRows.push(rowIndex);
            else selectedRows.splice(idx, 1);
            
            selectedRows.sort((a, b) => a - b);
            updateRowHighlights();
        }

        function updateRowHighlights() {
            // –°–±—Ä–æ—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
            document.querySelectorAll('.row-checkbox').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.cell').forEach(el => el.classList.remove('in-row'));

            selectedRows.forEach(r => {
                document.getElementById(`row-sel-${r}`).classList.add('selected');
                for(let c=0; c<N; c++) {
                    document.getElementById(`cell-${r}-${c}`).classList.add('in-row');
                }
            });

            const status = document.getElementById('statusText');
            if (selectedRows.length === 0) status.innerText = "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–≤–∞.";
            else status.innerHTML = `–í—ã–±—Ä–∞–Ω–æ —Å—Ç—Ä–æ–∫: <b>${selectedRows.length}</b>. –ì–æ—Ç–æ–≤ –∫ —Ä–∞—Å—á–µ—Ç—É.`;
        }

        // --- –ê–ª–≥–æ—Ä–∏—Ç–º –õ–∞–ø–ª–∞—Å–∞ ---

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—á–µ—Ç–∞–Ω–∏–π C(n, k)
        function getCombinations(n, k) {
            let result = [];
            function backtrack(start, current) {
                if (current.length === k) {
                    result.push([...current]);
                    return;
                }
                for (let i = start; i < n; i++) {
                    current.push(i);
                    backtrack(i + 1, current);
                    current.pop();
                }
            }
            backtrack(0, []);
            return result;
        }

        function startAlgorithm() {
            if (selectedRows.length === 0 || selectedRows.length === N) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç 1 –¥–æ 4 —Å—Ç—Ä–æ–∫.");
                return;
            }

            isRunning = true;
            currentStepIndex = 0;
            combinations = getCombinations(N, selectedRows.length);
            formulaLatex = ""; // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—É–ª—ã

            // UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnNext').disabled = false;
            document.getElementById('statusText').innerHTML = `–í—Å–µ–≥–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤: <b>${combinations.length}</b>. –ò—â–µ–º –º–∏–Ω–æ—Ä—ã...`;
            document.getElementById('stepViz').style.display = 'flex';
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Ñ–æ—Ä–º—É–ª—É
            updateMainFormula(`\\det(A) = \\sum (-1)^{i+j} M M^*`);
            
            // –ü–µ—Ä–≤—ã–π —à–∞–≥ —Å—Ä–∞–∑—É –∏–ª–∏ –ø–æ –∫–ª–∏–∫—É? –î–∞–≤–∞–π—Ç–µ –ø–æ –∫–ª–∏–∫—É –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
            document.getElementById('btnNext').innerText = "–ü–æ–∫–∞–∑–∞—Ç—å 1-–π —à–∞–≥";
        }

        function reset() {
            isRunning = false;
            selectedRows = [];
            updateRowHighlights();
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnNext').disabled = true;
            document.getElementById('btnNext').innerText = "–î–∞–ª–µ–µ";
            document.getElementById('stepViz').style.display = 'none';
            document.querySelectorAll('.cell').forEach(c => c.className = 'cell');
            updateMainFormula("\\det(A) = \\dots");
            document.getElementById('btnNext').classList.remove('btn-gen'); // —É–±—Ä–∞—Ç—å –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç —Ñ–∏–Ω–∏—à–∞
        }

        function nextStep() {
            if (currentStepIndex >= combinations.length) {
                document.getElementById('btnNext').disabled = true;
                document.getElementById('btnNext').innerText = "–ì–æ—Ç–æ–≤–æ";
                document.getElementById('statusText').innerHTML = "<b>–†–∞–∑–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</b>";
                return;
            }

            const cols = combinations[currentStepIndex];
            
            // 1. –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞ –º–∞—Ç—Ä–∏—Ü–µ
            highlightMatrix(cols);

            // 2. –í—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞–∫–∞
            // –°—É–º–º–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ (1-based)
            const sumRows = selectedRows.reduce((a, b) => a + (b + 1), 0);
            const sumCols = cols.reduce((a, b) => a + (b + 1), 0);
            const power = sumRows + sumCols;
            const signChar = (power % 2 === 0) ? "+" : "-";
            const signVal = (power % 2 === 0) ? 1 : -1;

            // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ LaTeX –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            // M_{—Å—Ç—Ä–æ–∫–∏, —Å—Ç–æ–ª–±—Ü—ã}
            const rowsStr = selectedRows.map(r=>r+1).join('');
            const colsStr = cols.map(c=>c+1).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π —Ñ–æ—Ä–º—É–ª–µ
            if (currentStepIndex === 0) {
                formulaLatex = (signChar === "-" ? "-" : "") + ` |M_{${colsStr}}| \\cdot |M^*_{${colsStr}}|`;
            } else {
                formulaLatex += ` ${signChar} |M_{${colsStr}}| \\cdot |M^*_{${colsStr}}|`;
            }
            updateMainFormula(`\\det(A) = ${formulaLatex}`);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞ (–ø–æ–¥—Ä–æ–±–Ω–æ)
            const stepMath = `(-1)^{${sumRows}+${sumCols}} \\cdot M_{${colsStr}} \\cdot M^*_{${colsStr}} \\Rightarrow \\mathbf{${signChar}1}`;
            renderMathInElement('stepFormula', stepMath);

            // 4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-–º–∞—Ç—Ä–∏—Ü
            drawMiniMatrices(cols);

            currentStepIndex++;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            if (currentStepIndex >= combinations.length) {
                document.getElementById('btnNext').innerText = "–ó–∞–≤–µ—Ä—à–∏—Ç—å";
                document.getElementById('btnNext').classList.add('btn-gen');
            } else {
                document.getElementById('btnNext').innerText = `–®–∞–≥ ${currentStepIndex+1}`;
            }
        }

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---

        function highlightMatrix(cols) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ü–≤–µ—Ç–∞, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
            for(let r=0; r<N; r++){
                for(let c=0; c<N; c++){
                    const cell = document.getElementById(`cell-${r}-${c}`);
                    cell.className = 'cell'; // reset
                    
                    const inRow = selectedRows.includes(r);
                    const inCol = cols.includes(c);

                    if (inRow && inCol) cell.classList.add('intersection');
                    else if (inRow) cell.classList.add('in-row');
                    else if (inCol) cell.classList.add('in-col');
                    else cell.classList.add('complement');
                }
            }
        }

        function drawMiniMatrices(cols) {
            // –ú–∏–Ω–æ—Ä (–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ)
            drawMiniGrid('minorViz', selectedRows, cols, '#f38ba8');

            // –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–æ—Å—Ç–∞—Ç–æ–∫)
            const remRows = [];
            const remCols = [];
            for(let i=0; i<N; i++) {
                if(!selectedRows.includes(i)) remRows.push(i);
                if(!cols.includes(i)) remCols.push(i);
            }
            drawMiniGrid('compViz', remRows, remCols, '#cba6f7');
        }

        function drawMiniGrid(containerId, rows, cols, color) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const grid = document.createElement('div');
            grid.className = 'mini-matrix';
            // Grid template based on dimension
            grid.style.gridTemplateColumns = `repeat(${cols.length}, 1fr)`;
            grid.style.background = color;

            rows.forEach(r => {
                cols.forEach(c => {
                    const d = document.createElement('div');
                    d.className = 'mini-cell';
                    d.innerText = matrix[r][c];
                    grid.appendChild(d);
                });
            });
            container.appendChild(grid);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MathJax
        function updateMainFormula(latex) {
            const el = document.getElementById('mainFormula');
            el.innerHTML = `$$ ${latex} $$`;
            MathJax.typesetPromise([el]).catch((err) => console.log(err));
        }

        function renderMathInElement(id, latex) {
            const el = document.getElementById(id);
            el.innerHTML = `$$ ${latex} $$`;
            MathJax.typesetPromise([el]).catch((err) => console.log(err));
        }

    </script>
</body>
</html>
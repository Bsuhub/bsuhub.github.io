<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢–µ–æ—Ä–µ–º–∞ –õ–∞–ø–ª–∞—Å–∞ (Fix)</title>
    <!-- 1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: { fontCache: 'global' }
      };
    </script>
    
    <!-- 2. –ü–æ—Ç–æ–º —Å–∞–º–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–æ–Ω–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—å –ø–æ—Ä—è–¥–æ–∫) -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --bg: #1e1e2e;
            --panel: #252635;
            --text: #cdd6f4;
            --accent: #89b4fa;
            --green: #a6e3a1;
            --red: #f38ba8;
            --purple: #cba6f7;
            --yellow: #f9e2af;
            --dim: #45475a;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø --- */
        .header-controls {
            width: 100%;
            background: #181825;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .control-group { display: flex; align-items: center; gap: 10px; }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–ª–∑—É–Ω–æ–∫ */
        input[type="range"] {
            -webkit-appearance: none;
            width: 120px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            height: 6px;
            background: var(--dim);
            border-radius: 5px;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px; height: 16px;
            background: var(--accent);
            border-radius: 50%;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            color: #1e1e2e;
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .btn-blue { background: var(--accent); }
        .btn-green { background: var(--green); }
        .btn-reset { background: var(--red); }

        /* --- –†–ê–ë–û–ß–ê–Ø –û–ë–õ–ê–°–¢–¨ --- */
        .workspace {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            padding: 20px;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- –ú–ê–¢–†–ò–¶–ê --- */
        .matrix-wrapper {
            background: var(--panel);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid var(--dim);
            overflow: auto; /* –°–∫—Ä–æ–ª–ª, –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
            max-width: 95vw;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* GRID: –¢–µ–ø–µ—Ä—å —ç—Ç–æ –µ–¥–∏–Ω–∞—è —Å–µ—Ç–∫–∞, –∏–Ω–¥–µ–∫—Å—ã –≤–Ω—É—Ç—Ä–∏ */
        .grid-container {
            display: inline-grid;
            gap: 4px;
            /* –®–∞–±–ª–æ–Ω –∫–æ–ª–æ–Ω–æ–∫ –∑–∞–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS */
            align-items: center;
            justify-items: center;
        }

        .cell {
            width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            background: #313244;
            border: 1px solid var(--dim);
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer; /* –ö—É—Ä—Å–æ—Ä —Ä—É–∫–∏ */
            user-select: none;
            transition: 0.2s;
        }
        
        /* –ò–Ω–¥–µ–∫—Å—ã (–∑–∞–≥–æ–ª–æ–≤–∫–∏) */
        .idx-header {
            font-size: 12px;
            color: #888;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%; height: 100%;
        }
        
        /* –ü—É—Å—Ç–æ–π —É–≥–æ–ª */
        .corner { width: 30px; height: 30px; }

        /* --- –°–û–°–¢–û–Ø–ù–ò–Ø --- */
        
        /* –ù–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É (–¥–æ —Å—Ç–∞—Ä—Ç–∞) */
        .cell:hover { background: #45475a; }

        /* –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–¥–æ —Å—Ç–∞—Ä—Ç–∞) */
        .cell.row-selected {
            background: rgba(249, 226, 175, 0.2);
            border-color: var(--yellow);
        }
        .idx-row.selected { color: var(--yellow); font-weight: 900; }
        .idx-row.selected::before { content: "‚ñ∂"; margin-right: 2px; font-size: 8px; }

        /* –ê–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü (–≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã) */
        .idx-col.active { color: var(--green); font-weight: 900; }
        .idx-col.active::after { content: "‚ñº"; display: block; font-size: 8px; }

        /* –¶–≤–µ—Ç–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã */
        .cell.dimmed { opacity: 0.2; border-color: transparent; cursor: default; }
        .cell.minor {
            background: var(--red) !important;
            color: #1e1e2e;
            font-weight: bold;
            opacity: 1 !important;
            transform: scale(1.05);
            z-index: 2;
            cursor: default;
        }
        .cell.complement {
            background: var(--purple) !important;
            color: #1e1e2e;
            opacity: 1 !important;
            cursor: default;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ –ø–æ–¥ –º–æ–±–∏–ª–∫–∏ */
        @media (max-width: 600px) {
            .cell { width: 34px; height: 34px; font-size: 13px; }
            input[type="range"] { width: 80px; }
            .header-controls { padding: 10px; gap: 8px; }
        }

        /* --- –ò–ù–§–û –ü–ê–ù–ï–õ–¨ --- */
        .info-area {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .card {
            background: var(--panel);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--dim);
        }
        .formula-box {
            background: #11111b;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
            text-align: center;
        }
        .mini-grid {
            display: inline-grid;
            gap: 1px;
            background: #fff;
            padding: 2px;
            margin-top: 5px;
        }
        .mini-cell {
            width: 25px; height: 25px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: black; font-weight: bold;
        }

    </style>
</head>
<body>

    <div class="header-controls">
        <div class="control-group">
            <label style="color:var(--accent); font-weight:bold;">N: <span id="sizeVal">5</span></label>
            <input type="range" id="sizeRange" min="3" max="10" value="5" oninput="resizeMatrix(this.value)">
        </div>
        <button class="btn-blue" onclick="generateMatrix()">üé≤ –ß–∏—Å–ª–∞</button>
        <button class="btn-green" id="btnStart" onclick="startAlgorithm()">üöÄ –ù–∞—á–∞—Ç—å</button>
        <button class="btn-blue" id="btnNext" onclick="nextStep()" disabled>–î–∞–ª–µ–µ</button>
        <button class="btn-reset" onclick="resetAll()">‚úñ –°–±—Ä–æ—Å</button>
        <button class="btn-exit" onclick="window.location.href='routing.html'">üè† –ì–ª–∞–≤–Ω–∞—è</button>
    </div>

    <div class="workspace">
        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –ú–∞—Ç—Ä–∏—Ü–∞ -->
        <div class="matrix-wrapper">
            <div id="hint" style="margin-bottom:10px; color:var(--green); text-align:center;">
                –ù–∞–∂–º–∏ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫—É
            </div>
            <div id="gridContainer" class="grid-container">
                <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JS -->
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –ò–Ω—Ñ–æ -->
        <div class="info-area">
            <div class="card">
                <h3 style="margin:0 0 10px 0; color:var(--accent)">–§–æ—Ä–º—É–ª–∞</h3>
                <div class="formula-box" id="mainFormula">$$ \det(A) = \dots $$</div>
            </div>

            <div class="card" id="stepCard" style="display:none;">
                <h3 style="margin:0 0 10px 0; color:var(--yellow)">–®–∞–≥ <span id="stepNum">0</span></h3>
                <div id="explanation" style="font-size: 0.95rem; line-height: 1.5;"></div>
                
                <div style="display:flex; justify-content:center; gap:20px; margin-top:15px; flex-wrap:wrap;">
                    <div style="text-align:center;">
                        <div style="color:var(--red); font-size:12px;">–ú–∏–Ω–æ—Ä M</div>
                        <div id="vizMinor"></div>
                    </div>
                    <div style="align-self:center; font-size:20px;">√ó</div>
                    <div style="text-align:center;">
                        <div style="color:var(--purple); font-size:12px;">–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ M*</div>
                        <div id="vizComp"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let N = 5;
        let matrix = [];
        let selectedRows = []; 
        let isRunning = false;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
        let combinations = [];
        let currentComboIdx = 0;
        let latexFormula = "";

        window.onload = () => {
            resizeMatrix(5);
        };

        function resizeMatrix(val) {
            N = parseInt(val);
            document.getElementById('sizeVal').innerText = N;
            resetAll();
            generateMatrix(); // –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ç–∫—É –∏ –¥–∞–Ω–Ω—ã–µ
        }

        function generateMatrix() {
            if(isRunning) resetAll();
            
            // 1. –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            matrix = [];
            for(let i=0; i<N; i++) {
                let row = [];
                for(let j=0; j<N; j++) row.push(Math.floor(Math.random()*19)-9);
                matrix.push(row);
            }

            // 2. –°—Ç—Ä–æ–∏–º HTML Grid
            renderGrid();
        }

        function renderGrid() {
            const container = document.getElementById('gridContainer');
            container.innerHTML = '';

            // –®–∞–±–ª–æ–Ω: 30px (–∏–Ω–¥–µ–∫—Å) + N –∫–æ–ª–æ–Ω–æ–∫ —è—á–µ–µ–∫
            const cellSize = window.innerWidth < 600 ? '34px' : '45px';
            container.style.gridTemplateColumns = `30px repeat(${N}, ${cellSize})`;

            // A) –ü—É—Å—Ç–æ–π —É–≥–æ–ª 0,0
            let corner = document.createElement('div');
            corner.className = 'corner';
            container.appendChild(corner);

            // B) –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ (–≤–µ—Ä—Ö–Ω–∏–π —Ä—è–¥)
            for(let j=0; j<N; j++) {
                let colHead = document.createElement('div');
                colHead.className = 'idx-header idx-col';
                colHead.id = `col-head-${j}`;
                colHead.innerText = j + 1;
                container.appendChild(colHead);
            }

            // C) –°—Ç—Ä–æ–∫–∏: –ò–Ω–¥–µ–∫—Å + –Ø—á–µ–π–∫–∏
            for(let i=0; i<N; i++) {
                // –ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫–∏ (—Å–ª–µ–≤–∞)
                let rowHead = document.createElement('div');
                rowHead.className = 'idx-header idx-row';
                rowHead.id = `row-head-${i}`;
                rowHead.innerText = i + 1;
                rowHead.onclick = () => toggleRow(i); // –ö–ª–∏–∫ –ø–æ –Ω–æ–º–µ—Ä—É
                rowHead.style.cursor = "pointer";
                container.appendChild(rowHead);

                // –Ø—á–µ–π–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                for(let j=0; j<N; j++) {
                    let cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${i}-${j}`;
                    cell.innerText = matrix[i][j];
                    // !!! –í–ê–ñ–ù–û: –ö–ª–∏–∫ –ø–æ —è—á–µ–π–∫–µ –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–æ–∫—É !!!
                    cell.onclick = () => toggleRow(i);
                    container.appendChild(cell);
                }
            }
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É, –µ—Å–ª–∏ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏ —á–∏—Å–ª–∞, –Ω–æ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏ –≤—ã–±–æ—Ä
            updateHighlights();
        }

        // --- –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ ---
        function toggleRow(r) {
            if(isRunning) return; // –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
            
            const idx = selectedRows.indexOf(r);
            if(idx === -1) selectedRows.push(r);
            else selectedRows.splice(idx, 1);
            
            selectedRows.sort((a,b)=>a-b);
            updateHighlights();
        }

        function updateHighlights() {
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤
            document.querySelectorAll('.cell').forEach(c => {
                c.classList.remove('row-selected', 'dimmed', 'minor', 'complement');
            });
            document.querySelectorAll('.idx-row').forEach(h => h.classList.remove('selected'));

            // –ü—Ä–∏–º–µ–Ω—è–µ–º selected
            selectedRows.forEach(r => {
                document.getElementById(`row-head-${r}`).classList.add('selected');
                for(let c=0; c<N; c++) {
                    document.getElementById(`cell-${r}-${c}`).classList.add('row-selected');
                }
            });

            const hint = document.getElementById('hint');
            if(selectedRows.length === 0) hint.innerHTML = "–ù–∞–∂–º–∏ –Ω–∞ –ª—é–±—É—é —è—á–µ–π–∫—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫—É";
            else hint.innerHTML = `–í—ã–±—Ä–∞–Ω–æ —Å—Ç—Ä–æ–∫: <b>${selectedRows.length}</b>. –ù–∞–∂–º–∏ "–ù–∞—á–∞—Ç—å"`;
        }

        // --- –ê–ª–≥–æ—Ä–∏—Ç–º ---
        function getCombinations(n, k) {
            let res = [];
            function bt(start, combo) {
                if(combo.length === k) { res.push([...combo]); return; }
                for(let i=start; i<n; i++) {
                    combo.push(i); bt(i+1, combo); combo.pop();
                }
            }
            bt(0, []);
            return res;
        }

        function startAlgorithm() {
            if(selectedRows.length === 0) { alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å—Ç—Ä–æ–∫–∏ (–∫–ª–∏–∫–Ω–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–µ)!"); return; }
            if(selectedRows.length === N) { alert("–ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å—Ä–∞–∑—É!"); return; }

            isRunning = true;
            currentComboIdx = 0;
            combinations = getCombinations(N, selectedRows.length);
            latexFormula = "";

            // UI
            document.getElementById('btnStart').disabled = true;
            document.getElementById('sizeRange').disabled = true;
            document.getElementById('btnNext').disabled = false;
            document.getElementById('btnNext').innerText = "–ü–æ–∫–∞–∑–∞—Ç—å 1-–π —à–∞–≥";
            document.getElementById('hint').innerText = "–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç...";
            document.getElementById('stepCard').style.display = 'block';

            updateFormula("\\det(A) = \\dots");
            document.getElementById('explanation').innerText = "–ù–∞–∂–º–∏ '–î–∞–ª–µ–µ' –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–≥–∞–µ–º–æ–≥–æ.";
        }

        function nextStep() {
            if(currentComboIdx >= combinations.length) {
                finish();
                return;
            }

            const cols = combinations[currentComboIdx];
            
            // 1. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ
            visualizeGridState(cols);

            // 2. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞
            const rowSum = selectedRows.reduce((a,b)=>a+(b+1),0);
            const colSum = cols.reduce((a,b)=>a+(b+1),0);
            const power = rowSum + colSum;
            const sign = (power % 2 === 0) ? "+" : "-";

            // 3. –§–æ—Ä–º—É–ª–∞
            const term = `${sign === '+' && currentComboIdx>0 ? '+' : sign} |M_{${currentComboIdx+1}}| \\cdot |M^*_{${currentComboIdx+1}}| `;
            latexFormula += term;
            updateFormula(`\\det(A) = ${latexFormula}`);

            // 4. –¢–µ–∫—Å—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            const rowsTxt = selectedRows.map(x=>x+1).join(',');
            const colsTxt = cols.map(x=>x+1).join(',');
            document.getElementById('stepNum').innerText = `${currentComboIdx+1} / ${combinations.length}`;
            
             const explHTML = `
                <div style="margin-bottom: 5px;">1. <b>–§–∏–∫—Å–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏:</b> ${rowsTxt}</div>
                <div style="margin-bottom: 5px;">2. <b>–ë–µ—Ä–µ–º —Å—Ç–æ–ª–±—Ü—ã:</b> ${colsTxt} (–∑–µ–ª–µ–Ω—ã–µ —Å—Ç—Ä–µ–ª–∫–∏)</div>
                
                <div style="margin-top: 10px; padding: 5px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                    3. <b>–í—ã—á–∏—Å–ª—è–µ–º –∑–Ω–∞–∫:</b>
                    $$(-1)^{(${rowsTxt.replace(/,/g,'+')}) + (${colsTxt.replace(/,/g,'+')})} = (-1)^{${power}} \\implies \\mathbf{${sign}1}$$
                </div>
                
                <div style="margin-top:10px; font-size:0.9em; color:#aaa">
                    (–ö—Ä–∞—Å–Ω—ã–µ —è—á–µ–π–∫–∏ –æ–±—Ä–∞–∑—É—é—Ç –º–∏–Ω–æ—Ä, —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–µ ‚Äî –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)
                </div>
            `;
            const exDiv = document.getElementById('explanation');
            exDiv.innerHTML = explHTML;
            MathJax.typesetPromise([exDiv]);

            // 5. –ú–∏–Ω–∏ –º–∞—Ç—Ä–∏—Ü—ã
            drawMiniGrid('vizMinor', selectedRows, cols, 'var(--red)');
            
            const restR = [], restC = [];
            for(let i=0; i<N; i++) if(!selectedRows.includes(i)) restR.push(i);
            for(let j=0; j<N; j++) if(!cols.includes(j)) restC.push(j);
            drawMiniGrid('vizComp', restR, restC, 'var(--purple)');

            currentComboIdx++;
            if(currentComboIdx >= combinations.length) {
                document.getElementById('btnNext').innerText = "–ó–∞–≤–µ—Ä—à–∏—Ç—å";
                document.getElementById('btnNext').className = "btn-green"; // –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç
            } else {
                document.getElementById('btnNext').innerText = "–î–∞–ª–µ–µ";
            }
        }

        function visualizeGridState(cols) {
            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç—Ä–µ–ª–æ–∫ –∫–æ–ª–æ–Ω–æ–∫
            document.querySelectorAll('.idx-col').forEach(el => el.classList.remove('active'));
            cols.forEach(c => document.getElementById(`col-head-${c}`).classList.add('active'));

            for(let i=0; i<N; i++) {
                for(let j=0; j<N; j++) {
                    const cell = document.getElementById(`cell-${i}-${j}`);
                    cell.className = 'cell'; // —Å–±—Ä–æ—Å
                    
                    const inRow = selectedRows.includes(i);
                    const inCol = cols.includes(j);

                    if(inRow && inCol) cell.classList.add('minor');
                    else if(!inRow && !inCol) cell.classList.add('complement');
                    else cell.classList.add('dimmed');
                }
            }
        }

        function drawMiniGrid(id, rows, cols, color) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            if(rows.length === 0 || cols.length === 0) {
                container.innerText = "1"; return;
            }
            const grid = document.createElement('div');
            grid.className = 'mini-grid';
            grid.style.gridTemplateColumns = `repeat(${cols.length}, 1fr)`;
            grid.style.border = `2px solid ${color}`;
            
            rows.forEach(r => {
                cols.forEach(c => {
                    let d = document.createElement('div');
                    d.className = 'mini-cell';
                    d.innerText = matrix[r][c];
                    grid.appendChild(d);
                });
            });
            container.appendChild(grid);
        }

        function resetAll() {
            isRunning = false;
            currentComboIdx = 0;
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º UI –≤ —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä–∞
            document.getElementById('btnStart').disabled = false;
            document.getElementById('sizeRange').disabled = false;
            document.getElementById('btnNext').disabled = true;
            document.getElementById('btnNext').innerText = "–î–∞–ª–µ–µ";
            document.getElementById('btnNext').className = "btn-blue";
            document.getElementById('stepCard').style.display = 'none';
            
            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—É–ª—ã
            updateFormula("\\det(A) = \\dots");
            
            // –°–±—Ä–æ—Å —Å—Ç—Ä–µ–ª–æ–∫
            document.querySelectorAll('.idx-col').forEach(el => el.classList.remove('active'));

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –≤—ã–±–æ—Ä–∞
            updateHighlights();
        }

        function finish() {
            document.getElementById('btnNext').disabled = true;
            document.getElementById('btnNext').innerText = "–ì–æ—Ç–æ–≤–æ";
            document.getElementById('explanation').innerHTML = "<b>–ì–æ—Ç–æ–≤–æ!</b> –°—É–º–º–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞.";
            
            // –£–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–∏–¥ –≤—ã–±–æ—Ä–∞
            updateHighlights();
            document.querySelectorAll('.idx-col').forEach(el => el.classList.remove('active'));
        }

        function updateFormula(tex) {
            const el = document.getElementById('mainFormula');
            el.innerHTML = `$$ ${tex} $$`;
            MathJax.typesetPromise([el]);
        }

    </script>
</body>
</html>
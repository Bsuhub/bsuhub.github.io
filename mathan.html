<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç–∞–Ω –ö–≤–∏–∑: –§–æ—Ä–º—É–ª—ã</title>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º MathJax -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --bg: #1e1e2e;
            --card: #313244;
            --text: #cdd6f4;
            --accent: #89b4fa;
            --green: #a6e3a1;
            --red: #f38ba8;
            --yellow: #f9e2af;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }

        h1 {
            color: var(--accent);
            margin-bottom: 5px;
            font-size: 1.5rem;
            text-align: center;
        }

        .subtitle {
            color: #a6adc8;
            font-size: 0.9rem;
            margin-bottom: 20px;
            text-align: center;
        }

        /* –≠–∫—Ä–∞–Ω—ã (–ú–µ–Ω—é, –ö–≤–∏–∑, –†–µ–∑—É–ª—å—Ç–∞—Ç) */
        .screen {
            width: 100%;
            max-width: 600px;
            display: none;
            /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            gap: 15px;
        }

        .screen.active {
            display: flex;
        }

        /* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        .menu-btn {
            background: var(--card);
            border: 2px solid var(--accent);
            color: var(--text);
            padding: 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-btn:active {
            transform: scale(0.98);
        }

        .menu-btn:hover {
            background: #45475a;
        }

        .icon {
            font-size: 1.5rem;
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–≤–∏–∑–∞ */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #11111b;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .question-box {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.3rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 500px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: #45475a;
            border: none;
            padding: 15px;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ */
        .option-btn.correct {
            background: var(--green) !important;
            color: #1e1e2e;
        }

        .option-btn.wrong {
            background: var(--red) !important;
            opacity: 0.6;
            color: #1e1e2e;
        }

        .option-btn:disabled {
            cursor: default;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        .result-card {
            background: var(--card);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }

        .score-big {
            font-size: 3rem;
            color: var(--accent);
            margin: 10px 0;
        }

        .btn-restart {
            background: var(--accent);
            color: #1e1e2e;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <!-- –≠–ö–†–ê–ù –ú–ï–ù–Æ -->
    <div id="menuScreen" class="screen active">
        <div>
            <h1>üß† –ú–∞—Ç–∞–Ω –¢—Ä–µ–Ω–∞–∂–µ—Ä</h1>
            <div class="subtitle">–í—ã–±–µ—Ä–∏ —Ç–µ–º—É –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
        </div>

        <button class="menu-btn" onclick="startQuiz('trig')">
            <span>üìê –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è</span> <span class="icon">‚ûú</span>
        </button>
        <button class="menu-btn" onclick="startQuiz('subs')">
            <span>üîÅ –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ò–Ω—Ç–µ–≥—Ä–∞–ª—ã)</span> <span class="icon">‚ûú</span>
        </button>
        <button class="menu-btn" onclick="startQuiz('deriv')">
            <span>‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ (–¢–∞–±–ª–∏—Ü–∞)</span> <span class="icon">‚ûú</span>
        </button>
        <button class="menu-btn" onclick="startQuiz('integ')">
            <span>‚à´ –ò–Ω—Ç–µ–≥—Ä–∞–ª—ã (–¢–∞–±–ª–∏—Ü–∞)</span> <span class="icon">‚ûú</span>
        </button>
        <button class="menu-btn" onclick="startQuiz('limit')">
            <span>üõë –ü—Ä–µ–¥–µ–ª—ã (–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏)</span> <span class="icon">‚ûú</span>
        </button>
        <button class="menu-btn" onclick="startQuiz('series')">
            <span>‚àë –†—è–¥—ã (–¢–µ–π–ª–æ—Ä)</span> <span class="icon">‚ûú</span>
        </button>

        <button class="menu-btn" onclick="window.location.href='routing.html'">
            <span>–î–æ–º–æ–π</span> <span class="icon">‚ûú</span>
        </button>
    </div>

    <!-- –≠–ö–†–ê–ù –ö–í–ò–ó–ê -->
    <div id="quizScreen" class="screen">
        <div class="quiz-header">
            <span id="progressText">1 / 10</span>
            <span style="color:var(--green)">–í–µ—Ä–Ω–æ: <span id="scoreText">0</span></span>
        </div>

        <div class="question-box" id="questionDisplay">
            <!-- –°—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–æ–ø—Ä–æ—Å -->
        </div>

        <div class="options-grid" id="optionsContainer">
            <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ -->
        </div>

        <button onclick="toMenu()"
            style="background:transparent; border:1px solid #666; color:#888; padding:10px; border-radius:5px; cursor:pointer; margin-top:20px;">
            –í—ã–π—Ç–∏ –≤ –º–µ–Ω—é
        </button>
    </div>

    <!-- –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
    <div id="resultScreen" class="screen">
        <div class="result-card">
            <h2>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
            <div class="score-big" id="finalScore">8/10</div>
            <p id="feedbackMsg">–ù–µ–ø–ª–æ—Ö–æ!</p>
            <button class="btn-restart" onclick="toMenu()">–í –º–µ–Ω—é</button>
        </div>
    </div>

    <script>
        // === –ë–ê–ó–ê –î–ê–ù–ù–´–• –í–û–ü–†–û–°–û–í ===
        // q: –í–æ–ø—Ä–æ—Å (LaTeX)
        // a: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (LaTeX)
        // type: –ö–∞—Ç–µ–≥–æ—Ä–∏—è
        const database = [
            // ==========================================
            // üìê –¢–†–ò–ì–û–ù–û–ú–ï–¢–†–ò–Ø (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
            // ==========================================
            // –°—É–º–º—ã –∏ —Ä–∞–∑–Ω–æ—Å—Ç–∏ (–ë–∞–∑–∞)
            { type: 'trig', q: '\\sin(\\alpha + \\beta)', a: '\\sin\\alpha\\cos\\beta + \\cos\\alpha\\sin\\beta' },
            { type: 'trig', q: '\\sin(\\alpha - \\beta)', a: '\\sin\\alpha\\cos\\beta - \\cos\\alpha\\sin\\beta' },
            { type: 'trig', q: '\\cos(\\alpha + \\beta)', a: '\\cos\\alpha\\cos\\beta - \\sin\\alpha\\sin\\beta' },
            { type: 'trig', q: '\\cos(\\alpha - \\beta)', a: '\\cos\\alpha\\cos\\beta + \\sin\\alpha\\sin\\beta' },
            { type: 'trig', q: '\\tan(\\alpha + \\beta)', a: '\\frac{\\tan\\alpha + \\tan\\beta}{1 - \\tan\\alpha\\tan\\beta}' },

            // –î–≤–æ–π–Ω—ã–µ –∏ —Ç—Ä–æ–π–Ω—ã–µ —É–≥–ª—ã
            { type: 'trig', q: '\\sin 2\\alpha', a: '2\\sin\\alpha\\cos\\alpha' },
            { type: 'trig', q: '\\cos 2\\alpha', a: '\\cos^2\\alpha - \\sin^2\\alpha' },
            { type: 'trig', q: '\\sin 3\\alpha', a: '3\\sin\\alpha - 4\\sin^3\\alpha' },
            { type: 'trig', q: '\\cos 3\\alpha', a: '4\\cos^3\\alpha - 3\\cos\\alpha' },

            // –ü–æ–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–µ–ø–µ–Ω–∏
            { type: 'trig', q: '\\sin^2\\alpha', a: '\\frac{1 - \\cos 2\\alpha}{2}' },
            { type: 'trig', q: '\\cos^2\\alpha', a: '\\frac{1 + \\cos 2\\alpha}{2}' },
            { type: 'trig', q: '\\sin^3\\alpha', a: '\\frac{3\\sin\\alpha - \\sin 3\\alpha}{4}' }, // –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞–ª–æ–≤

            // –°—É–º–º–∞ –≤ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            { type: 'trig', q: '\\sin\\alpha + \\sin\\beta', a: '2\\sin\\frac{\\alpha+\\beta}{2}\\cos\\frac{\\alpha-\\beta}{2}' },
            { type: 'trig', q: '\\cos\\alpha - \\cos\\beta', a: '-2\\sin\\frac{\\alpha+\\beta}{2}\\sin\\frac{\\alpha-\\beta}{2}' },

            // –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—É–º–º—É (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞–ª–æ–≤!)
            { type: 'trig', q: '\\sin\\alpha \\cos\\beta', a: '\\frac{1}{2}[\\sin(\\alpha-\\beta) + \\sin(\\alpha+\\beta)]' },
            { type: 'trig', q: '\\cos\\alpha \\cos\\beta', a: '\\frac{1}{2}[\\cos(\\alpha-\\beta) + \\cos(\\alpha+\\beta)]' },
            { type: 'trig', q: '\\sin\\alpha \\sin\\beta', a: '\\frac{1}{2}[\\cos(\\alpha-\\beta) - \\cos(\\alpha+\\beta)]' },

            // –¢–∞–Ω–≥–µ–Ω—Å –ø–æ–ª–æ–≤–∏–Ω–Ω–æ–≥–æ —É–≥–ª–∞ (–¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏)
            { type: 'trig', q: '\\sin x \\text{ —á–µ—Ä–µ–∑ } t=\\tan(x/2)', a: '\\frac{2t}{1+t^2}' },
            { type: 'trig', q: '\\cos x \\text{ —á–µ—Ä–µ–∑ } t=\\tan(x/2)', a: '\\frac{1-t^2}{1+t^2}' },

            // ==========================================
            // üîÅ –ü–û–î–°–¢–ê–ù–û–í–ö–ò (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
            // ==========================================
            // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ
            { type: 'subs', q: '\\int R(\\sin x, \\cos x)dx', a: 't = \\tan\\frac{x}{2} \\; \\text{(—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è)}' },
            { type: 'subs', q: '\\int R(\\sin^2 x, \\cos^2 x)dx', a: 't = \\tan x' },
            { type: 'subs', q: '\\sqrt{a^2 - x^2}', a: 'x = a\\sin t' },
            { type: 'subs', q: '\\sqrt{x^2 - a^2}', a: 'x = \\frac{a}{\\cos t}' },
            { type: 'subs', q: '\\sqrt{x^2 + a^2} \\; (Trig)', a: 'x = a\\tan t' },

            // –ì–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ–Ω—ã (—á–∞—Å—Ç–æ —É–¥–æ–±–Ω–µ–µ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö)
            { type: 'subs', q: '\\sqrt{x^2 + a^2} \\; (Hyp)', a: 'x = a \\; \\text{sh } t' },
            { type: 'subs', q: '\\sqrt{x^2 - a^2} \\; (Hyp)', a: 'x = a \\; \\text{ch } t' },

            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ
            { type: 'subs', q: '\\int \\frac{dx}{(1+x^2)^2}', a: 'x = \\tan t' },
            { type: 'subs', q: '\\int \\sqrt[n]{\\frac{ax+b}{cx+d}} dx', a: 't^n = \\frac{ax+b}{cx+d}' },

            // –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–∏–Ω–æ–º (–ß–µ–±—ã—à—ë–≤) x^m(a+bx^n)^p
            { type: 'subs', q: 'x^m(a+bx^n)^p, \\; p \\in \\mathbb{Z}', a: 'x = t^k \\text{ (–æ–±—â–∏–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å)}' },
            { type: 'subs', q: 'x^m(a+bx^n)^p, \\; \\frac{m+1}{n} \\in \\mathbb{Z}', a: 'a+bx^n = t^s' },
            { type: 'subs', q: 'x^m(a+bx^n)^p, \\; \\frac{m+1}{n} + p \\in \\mathbb{Z}', a: 'ax^{-n}+b = t^s' },

            // ==========================================
            // ‚ö° –ü–†–û–ò–ó–í–û–î–ù–´–ï (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
            // ==========================================
            // –ë–∞–∑–æ–≤—ã–µ
            { type: 'deriv', q: '(x^n)\'', a: 'nx^{n-1}' },
            { type: 'deriv', q: '(\\sqrt{x})\'', a: '\\frac{1}{2\\sqrt{x}}' },
            { type: 'deriv', q: '(\\frac{1}{x})\'', a: '-\\frac{1}{x^2}' },

            // –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–µ
            { type: 'deriv', q: '(a^x)\'', a: 'a^x \\ln a' },
            { type: 'deriv', q: '(e^x)\'', a: 'e^x' },
            { type: 'deriv', q: '(\\log_a x)\'', a: '\\frac{1}{x \\ln a}' },
            { type: 'deriv', q: '(\\ln x)\'', a: '\\frac{1}{x}' },
            { type: 'deriv', q: '(u^v)\' \\text{ (–ü–æ–∫–∞–∑.-—Å—Ç–µ–ø–µ–Ω–Ω–∞—è)}', a: 'u^v (v\'\\ln u + v\\frac{u\'}{u})' },

            // –ü—Ä–∞–≤–∏–ª–∞ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è
            { type: 'deriv', q: '(uv)\'', a: 'u\'v + uv\'' },
            { type: 'deriv', q: '(\\frac{u}{v})\'', a: '\\frac{u\'v - uv\'}{v^2}' },
            { type: 'deriv', q: '(f(g(x)))\'', a: 'f\'(g(x)) \\cdot g\'(x)' },

            // –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è
            { type: 'deriv', q: '(\\sin x)\'', a: '\\cos x' },
            { type: 'deriv', q: '(\\cos x)\'', a: '-\\sin x' },
            { type: 'deriv', q: '(\\tan x)\'', a: '\\frac{1}{\\cos^2 x}' },
            { type: 'deriv', q: '(\\cot x)\'', a: '-\\frac{1}{\\sin^2 x}' },

            // –û–±—Ä–∞—Ç–Ω—ã–µ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ
            { type: 'deriv', q: '(\\arcsin x)\'', a: '\\frac{1}{\\sqrt{1-x^2}}' },
            { type: 'deriv', q: '(\\arccos x)\'', a: '-\\frac{1}{\\sqrt{1-x^2}}' },
            { type: 'deriv', q: '(\\arctan x)\'', a: '\\frac{1}{1+x^2}' },
            { type: 'deriv', q: '(\\text{arccot } x)\'', a: '-\\frac{1}{1+x^2}' },

            // –ì–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–∏–µ
            { type: 'deriv', q: '(\\text{sh } x)\'', a: '\\text{ch } x' },
            { type: 'deriv', q: '(\\text{ch } x)\'', a: '\\text{sh } x' },
            { type: 'deriv', q: '(\\text{th } x)\'', a: '\\frac{1}{\\text{ch}^2 x}' },

            // –û–±—Ä–∞—Ç–Ω—ã–µ –≥–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–∏–µ (–ê—Ä–µ–∞-—Ñ—É–Ω–∫—Ü–∏–∏)
            { type: 'deriv', q: '(\\text{arsh } x)\'', a: '\\frac{1}{\\sqrt{1+x^2}}' },
            { type: 'deriv', q: '(\\text{arch } x)\'', a: '\\frac{1}{\\sqrt{x^2-1}}' },
            { type: 'deriv', q: '(\\text{arth } x)\'', a: '\\frac{1}{1-x^2}' },

            // ==========================================
            // ‚à´ –ò–ù–¢–ï–ì–†–ê–õ–´ (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
            // ==========================================
            // –°—Ç–µ–ø–µ–Ω–Ω—ã–µ –∏ –æ–±—â–∏–µ
            { type: 'integ', q: '\\int x^n dx, \\; n \\neq -1', a: '\\frac{x^{n+1}}{n+1}' },
            { type: 'integ', q: '\\int \\frac{dx}{x}', a: '\\ln|x|' },
            { type: 'integ', q: '\\int u dv \\text{ (–ü–æ —á–∞—Å—Ç—è–º)}', a: 'uv - \\int v du' },

            // –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–µ
            { type: 'integ', q: '\\int a^x dx', a: '\\frac{a^x}{\\ln a}' },
            { type: 'integ', q: '\\int e^x dx', a: 'e^x' },
            { type: 'integ', q: '\\int \\ln x dx', a: 'x\\ln x - x' }, // –í–∞–∂–Ω—ã–π —Ç–∞–±–ª–∏—á–Ω—ã–π!

            // –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ
            { type: 'integ', q: '\\int \\cos x dx', a: '\\sin x' },
            { type: 'integ', q: '\\int \\sin x dx', a: '-\\cos x' },
            { type: 'integ', q: '\\int \\frac{dx}{\\cos^2 x}', a: '\\tan x' },
            { type: 'integ', q: '\\int \\frac{dx}{\\sin^2 x}', a: '-\\cot x' },
            { type: 'integ', q: '\\int \\tan x dx', a: '-\\ln|\\cos x|' },
            { type: 'integ', q: '\\int \\cot x dx', a: '\\ln|\\sin x|' },
            { type: 'integ', q: '\\int \\frac{dx}{\\sin x}', a: '\\ln|\\tan\\frac{x}{2}|' },
            { type: 'integ', q: '\\int \\frac{dx}{\\cos x}', a: '\\ln|\\tan(\\frac{x}{2} + \\frac{\\pi}{4})|' },

            // –î—Ä–æ–±–∏ –∏ –∫–æ—Ä–Ω–∏ (–ê—Ä–∫–∏ –∏ –õ–æ–≥–∞—Ä–∏—Ñ–º—ã)
            { type: 'integ', q: '\\int \\frac{dx}{a^2+x^2}', a: '\\frac{1}{a}\\arctan\\frac{x}{a}' },
            { type: 'integ', q: '\\int \\frac{dx}{a^2-x^2} \\text{ (–í—ã—Å–æ–∫–∏–π)}', a: '\\frac{1}{2a}\\ln\\left|\\frac{a+x}{a-x}\\right|' },
            { type: 'integ', q: '\\int \\frac{dx}{x^2-a^2} \\text{ (–í—ã—Å–æ–∫–∏–π)}', a: '\\frac{1}{2a}\\ln\\left|\\frac{x-a}{x+a}\\right|' },
            { type: 'integ', q: '\\int \\frac{dx}{\\sqrt{a^2-x^2}}', a: '\\arcsin\\frac{x}{a}' },
            { type: 'integ', q: '\\int \\frac{dx}{\\sqrt{x^2 \\pm a^2}} \\text{ (–î–ª–∏–Ω–Ω—ã–π)}', a: '\\ln|x + \\sqrt{x^2 \\pm a^2}|' },

            // –ì–∏–ø–µ—Ä–±–æ–ª–∏—á–µ—Å–∫–∏–µ
            { type: 'integ', q: '\\int \\text{sh } x dx', a: '\\text{ch } x' },
            { type: 'integ', q: '\\int \\text{ch } x dx', a: '\\text{sh } x' },
            { type: 'integ', q: '\\int \\text{th } x dx', a: '\\ln(\\text{ch } x)' },

            // ==========================================
            // üõë –ü–†–ï–î–ï–õ–´ (–ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏ x -> 0)
            // ==========================================
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{\\sin x}{x}', a: '1' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{\\tan x}{x}', a: '1' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{\\arcsin x}{x}', a: '1' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{1 - \\cos x}{x^2}', a: '\\frac{1}{2}' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{\\ln(1+x)}{x}', a: '1' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{e^x - 1}{x}', a: '1' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{a^x - 1}{x}', a: '\\ln a' },
            { type: 'limit', q: '\\lim_{x\\to 0} \\frac{(1+x)^\\alpha - 1}{x}', a: '\\alpha' },
            { type: 'limit', q: '\\lim_{x\\to \\infty} (1 + \\frac{1}{x})^x', a: 'e' },
            { type: 'limit', q: '\\lim_{x\\to 0} (1 + x)^{\\frac{1}{x}}', a: 'e' },
            { type: 'limit', q: '\\lim_{n\\to \\infty} \\sqrt[n]{n}', a: '1' },

            // ==========================================
            // ‚àë –†–Ø–î–´ (–†–∞–∑–ª–æ–∂–µ–Ω–∏—è –ú–∞–∫–ª–æ—Ä–µ–Ω–∞)
            // ==========================================
            { type: 'series', q: 'e^x = \\dots', a: '1 + x + \\frac{x^2}{2!} + \\frac{x^3}{3!} + \\dots' },
            { type: 'series', q: '\\sin x = \\dots', a: 'x - \\frac{x^3}{3!} + \\frac{x^5}{5!} - \\dots' },
            { type: 'series', q: '\\cos x = \\dots', a: '1 - \\frac{x^2}{2!} + \\frac{x^4}{4!} - \\dots' },
            { type: 'series', q: '\\ln(1+x) = \\dots', a: 'x - \\frac{x^2}{2} + \\frac{x^3}{3} - \\dots' },
            { type: 'series', q: '(1+x)^\\alpha = \\dots', a: '1 + \\alpha x + \\frac{\\alpha(\\alpha-1)}{2!}x^2 + \\dots' },
            { type: 'series', q: '\\frac{1}{1-x} = \\dots (|x|<1)', a: '1 + x + x^2 + x^3 + \\dots' },
            { type: 'series', q: '\\arctan x = \\dots', a: 'x - \\frac{x^3}{3} + \\frac{x^5}{5} - \\dots' },
            { type: 'series', q: '\\sum_{n=1}^{\\infty} \\frac{1}{n} \\text{ (–ì–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–∏–π)}', a: '\\text{–†–∞—Å—Ö–æ–¥–∏—Ç—Å—è}' },
            { type: 'series', q: '\\sum_{n=1}^{\\infty} \\frac{1}{n^p} \\text{ —Å—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–∏:}', a: 'p > 1' }
        ];

        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø ===
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10; // –î–ª–∏–Ω–∞ —Ä–∞—É–Ω–¥–∞

        // === –õ–û–ì–ò–ö–ê ===

        function startQuiz(category) {
            // –§–∏–ª—å—Ç—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const pool = database.filter(item => item.type === category);

            if (pool.length < 4) {
                alert("–ú–∞–ª–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –±–∞–∑–µ –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!");
                return;
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∏ –±–µ—Ä–µ–º N –≤–æ–ø—Ä–æ—Å–æ–≤
            currentQuestions = shuffleArray([...pool]).slice(0, totalQuestions);

            currentQuestionIndex = 0;
            score = 0;

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω
            document.getElementById('menuScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('quizScreen').classList.add('active');

            renderQuestion();
        }

        function renderQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                endQuiz();
                return;
            }

            const qData = currentQuestions[currentQuestionIndex];

            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–ø–∫—É
            document.getElementById('progressText').innerText = `${currentQuestionIndex + 1} / ${currentQuestions.length}`;
            document.getElementById('scoreText').innerText = score;

            // –†–µ–Ω–¥–µ—Ä –≤–æ–ø—Ä–æ—Å–∞
            const qBox = document.getElementById('questionDisplay');
            qBox.innerHTML = `$$ ${qData.q} = ? $$`;

            // === –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –ü–û–î–ë–û–†–ê –û–¢–í–ï–¢–û–í ===

            // 1. –ù–∞—á–∏–Ω–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            let finalOptions = [qData];

            // 2. –°–æ–∑–¥–∞–µ–º –Ω–∞–±–æ—Ä (Set) —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤, 
            // —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥–≤—É—Ö –∫–Ω–æ–ø–æ–∫ "1")
            let usedAnswers = new Set();
            usedAnswers.add(qData.a);

            // 3. –ë–µ—Ä–µ–º –≤—Å–µ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const pool = database.filter(item => item.type === qData.type);
            const shuffledPool = shuffleArray([...pool]);

            // 4. –ò—â–µ–º 3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞
            for (let item of shuffledPool) {
                // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –µ—â–µ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è
                if (!usedAnswers.has(item.a)) {
                    finalOptions.push(item);
                    usedAnswers.add(item.a);
                }
                // –ï—Å–ª–∏ –Ω–∞–±—Ä–∞–ª–∏ 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ (1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π + 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö), –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
                if (finalOptions.length === 4) break;
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º
            finalOptions = shuffleArray(finalOptions);
            // =====================================

            const optContainer = document.getElementById('optionsContainer');
            optContainer.innerHTML = '';

            finalOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
                const isCorrect = (opt.a === qData.a);

                btn.innerHTML = `$$ ${opt.a} $$`;

                btn.onclick = () => checkAnswer(btn, isCorrect);
                optContainer.appendChild(btn);
            });

            // –ó–∞—Å—Ç–∞–≤–ª—è–µ–º MathJax –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã
            MathJax.typesetPromise();
        }

        function checkAnswer(btn, isCorrect) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            if (isCorrect) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                buttons.forEach(b => {
                    // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç (–≥—Ä—è–∑–Ω–æ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –º—ã –∑–Ω–∞–µ–º, —á—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏–ª–∏)
                    // –õ—É—á—à–µ –Ω–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É, —É –∫–æ—Ç–æ—Ä–æ–π onclick —Å—Å—ã–ª–∞–ª—Å—è –Ω–∞ true
                    // –ù–æ –ø—Ä–æ—â–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
                    // –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É —è–≤–Ω–æ, 
                    // –Ω–æ –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –µ—ë –ø–µ—Ä–µ–±–æ—Ä–æ–º, –µ—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏–º.
                    // –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É.
                });

                // –ù–∞–π–¥–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏ –ø–æ–¥—Å–≤–µ—Ç–∏–º –µ—ë
                const qData = currentQuestions[currentQuestionIndex];
                // –≠—Ç–æ –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–æ –∏–∑-–∑–∞ MathJax –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É
                // –º—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–µ–º. –í –æ–±—É—á–∞—é—â–∏—Ö —Ü–µ–ª—è—Ö –∏–Ω–æ–≥–¥–∞ –ª—É—á—à–µ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
            }

            setTimeout(() => {
                currentQuestionIndex++;
                renderQuestion();
            }, 1000);
        }

        function endQuiz() {
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');

            const finalEl = document.getElementById('finalScore');
            finalEl.innerText = `${score} / ${currentQuestions.length}`;

            const msg = document.getElementById('feedbackMsg');
            const percent = score / currentQuestions.length;

            if (percent === 1) msg.innerText = "–ò–¥–µ–∞–ª—å–Ω–æ! –¢—ã –ë–æ–≥ –º–∞—Ç–∞–Ω–∞! ü¶æ";
            else if (percent >= 0.8) msg.innerText = "–û—Ç–ª–∏—á–Ω–æ! –ü–æ—á—Ç–∏ –∑–∞—á–µ—Ç. üî•";
            else if (percent >= 0.5) msg.innerText = "–ù–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å. üìö";
            else msg.innerText = "–°—Ä–æ—á–Ω–æ –Ω–∞ –ø–µ—Ä–µ—Å–¥–∞—á—É! üíÄ";
        }

        function toMenu() {
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('menuScreen').classList.add('active');
        }

        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

    </script>
</body>

</html>